<div class="h-full w-full flex flex-col gap-4">
  <div class="size-full flex gap-4">
    <div class=" rounded-2xl w-full flex h-full">
      <p-fieldset legend="Create Mod" styleClass="main-bg-color -mt-5 rounded-2xl h-full"
        class="h-full w-full grow block">
        <div class="size-full flex flex-col gap-4" [formGroup]="modForm">
          <p-message class="shrink-0" severity="secondary" [closable]="true" variant="outlined">
            <div class="inline-flex items-center gap-4">
              <span class="material-symbols-outlined">warning</span>
              Disclaimer: Be careful when writing mods as they will be executed on the browser itself
              inside a sandbox. So accessing the DOM or accessing any browser APIs is not allowed.
            </div>
          </p-message>
          <div class="shrink-0 w-full flex border border-primary/20 rounded-xl p-3 gap-4">
            <div class="flex gap-2 items-start flex-col">
              <label for="name" class="text-sm">Mod Name</label>
              <input id="name" type="text" pInputText formControlName="name" placeholder="Enter mod name"
                class="w-full" />
            </div>
            <div class="flex gap-2 items-start flex-col">
              <label for="horizontal" class="text-sm">No. of Inputs</label>
              <p-inputnumber [showButtons]="true" buttonLayout="horizontal" inputId="horizontal"
                spinnerMode="horizontal" inputStyleClass="w-12 text-center" [min]="1" [formControlName]="'inputCount'">
                <ng-template #incrementbuttonicon>
                  <span class="material-symbols-outlined">add</span>
                </ng-template>
                <ng-template #decrementbuttonicon>
                  <span class="material-symbols-outlined">remove</span>
                </ng-template>
              </p-inputnumber>
            </div>
            <div class="flex gap-2 items-start flex-col">
              <label for="horizontal" class="text-sm">Visibility</label>
              <p-selectbutton [options]="stateOptions" formControlName="private" optionLabel="label" optionValue="value"
                aria-labelledby="basic" [allowEmpty]="false" />
            </div>
            <div class="flex gap-2 items-start flex-col grow min-h-[37px]">
              <label for="description" class="text-sm">Description</label>
              <textarea id="description" pTextarea rows="1" formControlName="description"
                placeholder="Enter mod description" class="w-full"></textarea>
            </div>
            <p-button label="Test & Save" class="self-end" [disabled]="!modForm.valid" (click)="onSubmit()" />
          </div>
          <div class="grow">
            <ngx-monaco-editor [options]="pasteEditorOptions"
              class="w-full h-full min-w-0 rounded-2xl overflow-clip border border-primary/20"
              style="height: 100%; width: 100%;" (onInit)="onInitEditor($event)"
              formControlName="code"></ngx-monaco-editor>
          </div>
        </div>
      </p-fieldset>
    </div>
  </div>
</div>

<p-drawer [(visible)]="modTestSidebarConfig().visible" header="Test & Save Mod"
  position="right" styleClass="w-[80vw]">
  <div class="h-full flex flex-col">
    <p-fieldset [legend]="'Options'" styleClass="main-bg-color rounded-2xl h-full shrink-0"
      class="h-auto w-full block">
      <div class="w-full flex gap-4 items-center">
        <span class="material-symbols-outlined text-primary opacity-75">info</span>
        <p class="opacity-75">
          Try running the mod with different inputs to see how it behaves. <br>
          If the mod runs successfully and produces the expected output, you can save it.
        </p>
        <div class="shrink-0 flex gap-2 ml-auto">
          <p-button label="Run Mod" (click)="runMod()" variant="outlined"
            [disabled]="!modForm.valid || !modTestSidebarConfig().inputs">
          </p-button>
          <p-button label="Save Mod" (click)="onSave()"
            [disabled]="!modTestSidebarConfig().runSuccess">
          </p-button>
        </div>
      </div>
    </p-fieldset>
    <div class="h-full flex gap-6 overflow-auto">
      <div class="grow overflow-auto flex flex-col gap-2 pt-2 w-[50%]">
        @for (i of getIterableOf(modTestSidebarConfig().inputs); track $index) {
          <p-fieldset [legend]="'Input ' + ($index + 1)" styleClass="main-bg-color rounded-2xl h-full"
            class="h-full w-full grow block">
            <ngx-monaco-editor [options]="plainTextOptions"
              class="w-full h-full grow min-h-[25vh] min-w-0 rounded-2xl overflow-clip" style="height: 100%; width: 100%;"
              [(ngModel)]="modTestSidebarConfig().args[$index]"></ngx-monaco-editor>
          </p-fieldset>
        }
      </div>
      <div class="grow overflow-auto flex flex-col gap-2 pt-2 w-[50%] h-full">
        <p-fieldset [legend]="'Output'" styleClass="main-bg-color rounded-2xl h-full block"
          class="h-full w-full grow block">
          <ngx-monaco-editor [options]="plainTextOptionsWithReadonly" (onInit)="setReadonly($event)"
            class="w-full h-full grow min-h-[25vh] min-w-0 rounded-2xl overflow-clip" style="height: 100%; width: 100%;"
            [(ngModel)]="modTestSidebarConfig().output"></ngx-monaco-editor>
        </p-fieldset>
      </div>
    </div>
  </div>
</p-drawer>
